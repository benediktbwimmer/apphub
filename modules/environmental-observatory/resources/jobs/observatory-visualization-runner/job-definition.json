{
  "slug": "observatory-visualization-runner",
  "name": "Observatory Visualization Runner",
  "type": "batch",
  "runtime": "node",
  "entryPoint": "bundle:observatory-visualization-runner@0.2.0#handler",
  "timeoutMs": 150000,
  "retryPolicy": {
    "maxAttempts": 2,
    "strategy": "fixed",
    "initialDelayMs": 10000
  },
  "parametersSchema": {
    "type": "object",
    "properties": {
      "timestoreBaseUrl": {
        "type": "string",
        "minLength": 1
      },
      "timestoreDatasetSlug": {
        "type": "string",
        "minLength": 1
      },
      "timestoreAuthToken": {
        "type": "string"
      },
      "filestoreBaseUrl": {
        "type": "string",
        "minLength": 1
      },
      "filestoreBackendId": {
        "type": [
          "integer",
          "null"
        ],
        "minimum": 1
      },
      "filestoreToken": {
        "type": "string"
      },
      "filestorePrincipal": {
        "type": "string"
      },
      "visualizationsPrefix": {
        "type": "string",
        "minLength": 1
      },
      "partitionKey": {
        "type": "string"
      },
      "partitionWindow": {
        "type": "string"
      },
      "partitionKeyFields": {
        "type": "object",
        "additionalProperties": true
      },
      "instrumentId": {
        "type": "string"
      },
      "lookbackMinutes": {
        "type": "number",
        "minimum": 1,
        "maximum": 10080
      },
      "siteFilter": {
        "type": "string"
      },
      "dataset": {
        "type": "string"
      },
      "filestoreBackendKey": {
        "type": "string",
        "minLength": 1
      }
    },
    "required": [
      "timestoreBaseUrl",
      "timestoreDatasetSlug",
      "filestoreBaseUrl",
      "visualizationsPrefix",
      "filestoreBackendKey"
    ]
  },
  "defaultParameters": {
    "lookbackMinutes": 180,
    "instrumentId": null,
    "filestorePrincipal": null,
    "filestoreToken": null,
    "siteFilter": null,
    "partitionKey": null,
    "partitionWindow": null,
    "dataset": null,
    "filestoreBackendKey": "observatory-event-driven-s3"
  },
  "outputSchema": {
    "type": "object",
    "properties": {
      "generatedAt": {
        "type": "string",
        "format": "date-time"
      },
      "partitionKey": {
        "type": "string"
      },
      "partitionWindow": {
        "type": "string"
      },
      "storagePrefix": {
        "type": "string"
      },
      "lookbackMinutes": {
        "type": "number"
      },
      "dataset": {
        "type": "string"
      },
      "artifacts": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string"
            },
            "nodeId": {
              "type": "number"
            },
            "mediaType": {
              "type": "string"
            },
            "description": {
              "type": "string"
            },
            "sizeBytes": {
              "type": "number"
            },
            "checksum": {
              "type": "string"
            }
          },
          "required": [
            "path",
            "mediaType"
          ]
        }
      },
      "metrics": {
        "type": "object",
        "properties": {
          "samples": {
            "type": "number"
          },
          "instrumentCount": {
            "type": "number"
          },
          "siteCount": {
            "type": "number"
          },
          "averageTemperatureC": {
            "type": "number"
          },
          "averagePm25": {
            "type": "number"
          },
          "maxPm25": {
            "type": "number"
          },
          "partitionKey": {
            "type": "string"
          },
          "partitionWindow": {
            "type": "string"
          },
          "lookbackMinutes": {
            "type": "number"
          },
          "siteFilter": {
            "type": [
              "string",
              "null"
            ]
          },
          "instrumentId": {
            "type": [
              "string",
              "null"
            ]
          },
          "dataset": {
            "type": [
              "string",
              "null"
            ]
          }
        },
        "required": [
          "samples",
          "instrumentCount",
          "siteCount",
          "averageTemperatureC",
          "averagePm25",
          "maxPm25",
          "partitionKey",
          "partitionWindow",
          "lookbackMinutes"
        ]
      }
    },
    "required": [
      "generatedAt",
      "partitionKey",
      "partitionWindow",
      "storagePrefix",
      "lookbackMinutes",
      "artifacts",
      "metrics"
    ]
  }
}
