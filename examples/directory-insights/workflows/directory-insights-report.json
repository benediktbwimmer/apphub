{
  "slug": "directory-insights-report",
  "name": "Directory Insights Report",
  "version": 1,
  "description": "Scans a filesystem tree and renders HTML/JSON/Markdown insights.",
  "parametersSchema": {
    "type": "object",
    "properties": {
      "scanDir": { "type": "string", "minLength": 1 },
      "outputDir": { "type": "string", "minLength": 1 },
      "maxEntries": { "type": "number", "minimum": 1000, "maximum": 200000 },
      "reportTitle": { "type": "string" }
    },
    "required": ["scanDir", "outputDir"]
  },
  "defaultParameters": {
    "maxEntries": 20000,
    "reportTitle": "Directory Visualization Report"
  },
  "steps": [
    {
      "id": "scan",
      "name": "Scan directory",
      "type": "job",
      "jobSlug": "scan-directory",
      "parameters": {
        "scanDir": "{{ parameters.scanDir }}",
        "maxEntries": "{{ parameters.maxEntries }}"
      },
      "storeResultAs": "scanResults"
    },
    {
      "id": "report",
      "name": "Generate Visualization",
      "type": "job",
      "jobSlug": "generate-visualizations",
      "dependsOn": ["scan"],
      "parameters": {
        "scanData": "{{ shared.scanResults }}",
        "outputDir": "{{ parameters.outputDir }}",
        "reportTitle": "{{ parameters.reportTitle }}"
      },
      "storeResultAs": "visualization",
      "produces": [
        {
          "assetId": "directory.insights.report",
          "schema": {
            "type": "object",
            "properties": {
              "outputDir": { "type": "string" },
              "reportTitle": { "type": "string" },
              "rootPath": { "type": "string" },
              "generatedAt": { "type": "string", "format": "date-time" },
              "summary": { "type": "object" },
              "artifacts": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "relativePath": { "type": "string" },
                    "mediaType": { "type": "string" },
                    "description": { "type": "string" },
                    "sizeBytes": { "type": "number" }
                  },
                  "required": ["relativePath", "mediaType", "sizeBytes"]
                }
              }
            },
            "required": ["outputDir", "reportTitle", "generatedAt", "artifacts"]
          }
        }
      ]
    }
  ],
  "triggers": [
    { "type": "manual" }
  ]
}
