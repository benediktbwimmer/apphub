{
  "slug": "observatory-report-publisher",
  "name": "Observatory Report Publisher",
  "type": "batch",
  "runtime": "node",
  "entryPoint": "bundle:observatory-report-publisher@0.1.0#handler",
  "timeoutMs": 180000,
  "retryPolicy": {
    "maxAttempts": 2,
    "strategy": "fixed",
    "initialDelayMs": 15000
  },
  "parametersSchema": {
    "type": "object",
    "properties": {
      "reportsPrefix": {
        "type": "string",
        "minLength": 1
      },
      "partitionKey": {
        "type": "string",
        "minLength": 1
      },
      "instrumentId": {
        "type": "string"
      },
      "reportTemplate": {
        "type": "string"
      },
      "visualizationAsset": {
        "type": "object"
      },
      "filestoreBaseUrl": {
        "type": "string",
        "minLength": 1
      },
      "filestoreBackendId": {
        "type": [
          "integer",
          "null"
        ],
        "minimum": 1
      },
      "filestoreToken": {
        "type": "string"
      },
      "filestorePrincipal": {
        "type": "string"
      },
      "metastoreBaseUrl": {
        "type": "string"
      },
      "metastoreAuthToken": {
        "type": "string"
      },
      "metastoreNamespace": {
        "type": "string"
      },
      "filestoreBackendKey": {
        "type": "string",
        "minLength": 1
      }
    },
    "required": [
      "reportsPrefix",
      "partitionKey",
      "visualizationAsset",
      "filestoreBaseUrl",
      "filestoreBackendKey"
    ]
  },
  "outputSchema": {
    "type": "object",
    "properties": {
      "generatedAt": {
        "type": "string",
        "format": "date-time"
      },
      "storagePrefix": {
        "type": "string"
      },
      "reportFiles": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string"
            },
            "nodeId": {
              "type": "number"
            },
            "mediaType": {
              "type": "string"
            },
            "sizeBytes": {
              "type": "number"
            },
            "checksum": {
              "type": "string"
            }
          },
          "required": [
            "path",
            "mediaType"
          ]
        }
      },
      "summary": {
        "type": "object",
        "properties": {
          "instrumentCount": {
            "type": "number"
          },
          "siteCount": {
            "type": "number"
          },
          "alertCount": {
            "type": "number"
          }
        }
      },
      "plotsReferenced": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string"
            },
            "altText": {
              "type": "string"
            }
          },
          "required": [
            "path"
          ]
        }
      },
      "instrumentId": {
        "type": "string"
      }
    },
    "required": [
      "generatedAt",
      "storagePrefix",
      "reportFiles"
    ]
  }
}
