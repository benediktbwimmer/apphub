{
  "slug": "observatory-hourly-data-generator",
  "name": "Observatory Minute Data Generator",
  "version": 1,
  "description": "Produces synthetic minute-level CSV drops to simulate instrument readings arriving in the inbox.",
  "parametersSchema": {
    "type": "object",
    "properties": {
      "inboxDir": { "type": "string", "minLength": 1 },
      "minute": {
        "type": "string",
        "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}$"
      },
      "rowsPerInstrument": { "type": "number", "minimum": 1, "maximum": 360 },
      "intervalMinutes": { "type": "number", "minimum": 1, "maximum": 120 },
      "seed": { "type": "number" }
    },
    "required": ["inboxDir", "minute"]
  },
  "defaultParameters": {
    "inboxDir": "examples/environmental-observatory/data/inbox",
    "rowsPerInstrument": 6,
    "intervalMinutes": 10
  },
  "steps": [
    {
      "id": "generate-synthetic-drop",
      "name": "Generate synthetic instrument readings",
      "type": "job",
      "jobSlug": "observatory-data-generator",
      "parameters": {
        "inboxDir": "{{ parameters.inboxDir }}",
        "minute": "{{ parameters.minute }}",
        "rowsPerInstrument": "{{ parameters.rowsPerInstrument }}",
        "intervalMinutes": "{{ parameters.intervalMinutes }}",
        "seed": "{{ parameters.seed }}"
      },
      "storeResultAs": "syntheticDrop",
      "produces": [
        {
          "assetId": "observatory.inbox.synthetic",
          "partitioning": {
            "type": "timeWindow",
            "granularity": "minute",
            "format": "YYYY-MM-DDTHH:mm",
            "lookbackWindows": 1440
          },
          "schema": {
            "type": "object",
            "properties": {
              "generatedAt": { "type": "string", "format": "date-time" },
              "partitionKey": { "type": "string" },
              "inboxDir": { "type": "string" },
              "rowsGenerated": { "type": "number" },
              "instrumentCount": { "type": "number" },
              "files": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "relativePath": { "type": "string" },
                    "instrumentId": { "type": "string" },
                    "site": { "type": "string" },
                    "rows": { "type": "number" }
                  },
                  "required": ["relativePath", "instrumentId", "rows"]
                }
              }
            },
            "required": [
              "generatedAt",
              "partitionKey",
              "inboxDir",
              "rowsGenerated",
              "instrumentCount",
              "files"
            ]
          }
        }
      ]
    }
  ],
  "triggers": [
    { "type": "manual" }
  ]
}
