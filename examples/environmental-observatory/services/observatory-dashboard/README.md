# Observatory Dashboard Service

The dashboard renders the latest observatory report bundle (HTML/MD/JSON) and auto-refreshes so operators always see a fresh status page. Paths and dataset details are sourced from the shared observatory config.

## Development

```bash
npm install
OBSERVATORY_CONFIG_PATH="${OBSERVATORY_CONFIG_PATH:-${APPHUB_SCRATCH_ROOT:-/tmp/apphub-scratch}/observatory/config/observatory-config.json}" \
PORT=4311 \
HOST=0.0.0.0 \
DASHBOARD_REFRESH_MS=10000 \
npm run dev
```

`REPORTS_DIR` is no longer required; the service resolves it from the config file (you can still override it explicitly if needed).

## Environment Variables

| Variable | Default | Description |
| --- | --- | --- |
| `OBSERVATORY_CONFIG_PATH` | `${OBSERVATORY_DATA_ROOT}/config/observatory-config.json` | Location of the generated config file. |
| `PORT` | `4311` | HTTP port the dashboard listens on. |
| `HOST` | `0.0.0.0` | Bind interface. |
| `DASHBOARD_REFRESH_MS` | `10000` | Client polling interval for `/api/status`. |
| `REPORTS_DIR` | *(inferred from config)* | Optional override for the reports directory. |

## Endpoints
- `GET /healthz` – liveness check including the resolved reports directory.
- `GET /api/status` – JSON payload describing the most recent report (partition key, summary metrics, artefact list, relative links).
- `GET /reports/*` – static file server rooted at the reports directory with caching disabled.
- `GET /` – minimal HTML shell that polls `/api/status` and links to the artefacts for quick inspection.

The service reads `status.json` directly from disk on each refresh, so new partitions generated by the publication workflow appear without restarts.
